<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product</title>
    <link rel="stylesheet" href="./assets/css/product.css" />
    <link rel="stylesheet" href="./assets/css/common/common.css" />
    <link rel="stylesheet" href="./assets/css/common/quotes.css" />
    <script src="./assets/js/jquery-3.5.1.min.js"></script>
    <script>

    </script>
</head>

<body>
    <?php
    include_once "./header.php"
    ?>
    <main>
        <section class="main-titl-and-filter">
            <div class="breadcrumb-items">
                <a href="#" class="breadcrumb-home">HOME</a>
                <span class="breadcrumb-shop">/ SHOP</span>
            </div>
            <h1 class="main-titl">SHOP</h1>
            <div class="main-filter-items">
                <div class="sorting-items">
                    <span class="sort-by-item">SORT BY : </span>
                    <span class="sort-filter">
                        <a href="#" class="bst-mtch">BEST MATCH</a>
                    </span>
                </div>
                <div class="filter-items">
                    <span class="product-fltr-icn">
                        <img class="fltr-icn" src="./assets/icons/filter.svg" alt="filter icon">
                    </span>
                    <span class="main-filter">
                        <a href="#" class="prdct-fltr">FILTERS</a>
                    </span>
                </div>
            </div>
        </section>
        <section class="main-product-items" id="product-list">

            <?php
            include_once $_SERVER["DOCUMENT_ROOT"] . "/Organic-Cart/includes/common/constant.php";
            include_once MAIN_URL . "/Organic-Cart/includes/dao/product_dao.php";
            $product_dao = new ProductDao();
            $data["page"] = 1;
            $result = $product_dao->fetchProducts($data);
            foreach ($result as $prdct_row) {
            ?>
                <div class="product-wrapper" id="<?php echo $prdct_row['id'] ?>">
                    <div class="product-pic-round">
                        <div class="product-img">
                            <img src="./assets/images/products/<?php echo $prdct_row['image'] ?>" alt="apple" class="fruit-product" />
                        </div>
                    </div>
                    <div class="product-details">
                        <h2 class="product-name"><?php echo $prdct_row['name'] ?></h2>
                        <p class="product-quantity"><?php echo $prdct_row['sku'][0]['title'] ?></p>
                        <p class="product-price">
                            Rs.<span class="product-discnt-price discount-price"><?php echo $prdct_row['sku'][0]['discounted_price'] ?></span>
                            <?php
                            $discount = $prdct_row['sku'][0]['discount'];
                            if ($discount == null) { ?>
                                <span class="main-price prodct-price" style="display: none;">
                                    <del>Rs.<span class="product-actual-price actual-price"><?php echo $prdct_row['sku'][0]['actual_price'] ?></span></del>
                                </span>
                                <span class="product-discount-wrapper" style="display: none;">
                                    <span class="prdct-discnt discount-percent"><?php echo $discount ?></span>
                                    <span class="prdct-discnt-of">Off</span>
                                </span>
                            <?php } else { ?>
                                <span class="main-price prodct-price">
                                    <del>Rs.<span class="product-actual-price actual-price"><?php echo $prdct_row['sku'][0]['actual_price'] ?></span></del>
                                </span>
                                <span class="product-discount-wrapper">
                                    <span class="prdct-discnt discount-percent"><?php echo $discount ?></span>
                                    <span class="prdct-discnt-of">Off</span>
                                </span>
                            <?php } ?>
                        </p>
                    </div>
                    <div class="add-to-cart-details">
                        <h2 class="cart-product-name"><?php echo $prdct_row['name'] ?></h2>
                        <div class="drop-down" id="<?php echo $prdct_row['id'] ?>">
                            <div class="slctd-box">
                                <div class="slctd-opt"><?php echo $prdct_row['sku'][0]['title'] ?></div>
                                <span class="drp-dwn-btn-wrpr">
                                    <svg version="1.1" class="drp-dwn-btn-icn" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="451.847px" height="451.847px" viewBox="0 0 451.847 451.847" fill="#f5764d" style="enable-background:new 0 0 451.847 451.847;" xml:space="preserve">
                                        <g>
                                            <path d="M225.923,354.706c-8.098,0-16.195-3.092-22.369-9.263L9.27,151.157c-12.359-12.359-12.359-32.397,0-44.751
                                            c12.354-12.354,32.388-12.354,44.748,0l171.905,171.915l171.906-171.909c12.359-12.354,32.391-12.354,44.744,0
                                            c12.365,12.354,12.365,32.392,0,44.751L248.292,345.449C242.115,351.621,234.018,354.706,225.923,354.706z" />
                                        </g>
                                    </svg>
                                </span>
                            </div>
                            <div class="optns-wrpr">
                                <?php
                                $dropdown = count($prdct_row['sku']);
                                for ($i = 0; $i < $dropdown; $i++) {
                                    if ($i == 0) {
                                ?>
                                        <div class="opt-nam" style="color:#38251d" data-sku-id="<?php echo $prdct_row['sku'][$i]['id'] ?>" data-discount="<?php echo $prdct_row['sku'][$i]['discount'] ?>" data-discount-price="<?php echo $prdct_row['sku'][$i]['discounted_price'] ?>" data-actual-price="<?php echo $prdct_row['sku'][$i]['actual_price'] ?>">
                                            <?php echo $prdct_row['sku'][$i]['title'] ?>
                                        </div>
                                    <?php } else { ?>
                                        <div class="opt-nam" data-sku-id="<?php echo $prdct_row['sku'][$i]['id'] ?>" data-discount="<?php echo $prdct_row['sku'][$i]['discount'] ?>" data-discount-price="<?php echo $prdct_row['sku'][$i]['discounted_price'] ?>" data-actual-price="<?php echo $prdct_row['sku'][$i]['actual_price'] ?>">
                                            <?php echo $prdct_row['sku'][$i]['title'] ?>
                                        </div>
                                    <?php } ?>
                                <?php } ?>
                            </div>
                        </div>

                        <p class="cart-product-price">
                            Rs.<span class="cart-product-discnt-price discount-price"><?php echo $prdct_row['sku'][0]['discounted_price'] ?></span>

                            <?php
                            $discount = $prdct_row['sku'][0]['discount'];
                            if ($discount == null) { ?>
                                <span class="cart-main-price prodct-price" style="display: none;">
                                    <del>Rs.<span class="cart-product-actual-price actual-price"><?php echo $prdct_row['sku'][0]['actual_price'] ?></span></del>
                                </span>
                                <span class="product-discount-wrapper" style="display: none;">
                                    <span class="cart-prdct-discnt discount-percent"><?php echo $discount ?></span>
                                    <span class="cart-prdct-discnt-of">Off</span>
                                </span>
                            <?php } else { ?>
                                <span class="cart-main-price prodct-price">
                                    <del>Rs.<span class="cart-product-actual-price actual-price"><?php echo $prdct_row['sku'][0]['actual_price'] ?></span></del>
                                </span>
                                <span class="product-discount-wrapper">
                                    <span class="prdct-discnt discount-percent"><?php echo $discount ?></span>
                                    <span class="prdct-discnt-of">Off</span>
                                </span>
                            <?php } ?>
                        </p>
                        <div class="main-quantity-items">
                            <div class="quantity-item qnty-minus-btn" id="minus-<?php echo $prdct_row['id'] ?>"></div>
                            <span class="no-of-items" id="qnty-count">1</span>
                            <div class=" quantity-item qnty-plus-btn" id="plus-<?php echo $prdct_row['id'] ?>"></div>
                        </div>

                        <div class="add-to-cart-item">
                            <button class="add-to-cart-btn">
                                Add to Cart
                                <span>
                                    <svg class="cart-btn-arrow" id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                                        <defs>
                                            <style>
                                                .cls-1 {
                                                    fill: #fff;
                                                }
                                            </style>
                                        </defs>
                                        <title>White Arrow</title>
                                        <path class="cls-1" d="M334.72,409a15.85,15.85,0,1,1-22.53-22.31L426.45,272.4H49.4a15.87,15.87,0,0,1-16-15.78,16.07,16.07,0,0,1,16-16h377l-114.26-114a16.18,16.18,0,0,1,0-22.53,15.79,15.79,0,0,1,22.53,0L476,245.35a15.9,15.9,0,0,1,0,22.31Z" />
                                    </svg>
                                </span>
                            </button>
                        </div>
                    </div>
                </div>
            <?php
            }
            ?>
        </section>
        <section class="main-folks-item">
            <div class="folk-items">
                <div class="left-hori-line"></div>
                <h3 class="folk-content">That's all folks</h3>
                <div class="right-hori-line"></div>
            </div>
        </section>
        <section class="main-product-content">
            <div class="product-content-items">
                <h2 class="content-title">Fresh Fruit Online</h2>
                <p class="content-item content-item-one">
                    For pregnant women, a combination of fresh fruits and vegetables can
                    be used to make yummy smoothies, juices or salads. Such a diet is
                    extremely beneficial for the unborn baby as well as the mother. Any
                    fruits and vegetables list must include fruits from every colour
                    group like all those bright red strawberries, yellow bananas, blue
                    berries, etc so that you get all varieties of nutrients in your
                    diet. A healthy fruits and vegetables list must be the priority of
                    any homemaker, as a healthy diet ensures that everyone in the family
                    is healthy. You can buy fresh fruits and vegetable online from our
                    store, and mix and match them in recipes for your children and for
                    yourself. So go on and buy vegetables & fruitssapotaonline at
                    bigbasket.
                </p>
                <h2 class="content-title">Vegetables and fruits India</h2>
                <p class="content-item">
                    For pregnant women, a combination of fresh fruits and vegetables can
                    be used to make yummy smoothies, juices or salads. Such a diet is
                    extremely beneficial for the unborn baby as well as the mother. Any
                    fruits and vegetables list must include fruits from every colour
                    group like all those bright red strawberries, yellow bananas, blue
                    berries, etc so that you get all varieties of nutrients in your
                    diet. A healthy fruits and vegetables list must be the priority of
                    any homemaker, as a healthy diet ensures that everyone in the family
                    is healthy. You can buy fresh fruits and vegetable online from our
                    store, and mix and match them in recipes for your children and for
                      yourself. So go on and buy vegetables & fruitssapotaonline at
                    bigbasket.
                </p>
            </div>
        </section>

        <?php
        include_once "./quotes.php"
        ?>
    </main>
    <?php
    include_once "./footer.php"
    ?>
</body>
<script>
    $pageNumber = 2;
    $loading = false;
    $totalCount = 0;
    $productCount = $("#product-list").children().length;
    // console.log("Initial Count" + $productCount);
    function loadMoreProducts() {
        $loading = true;
        $.ajax({
            type: "GET",
            dataType: "json",
            url: "http://localhost/Organic-Cart/services/fetch-products.php?page=" + $pageNumber,
            success: function(data) {
                if (data.status == 200) {
                    $totalCount = data.data.total_count;
                    // console.log("TOTAL COUNT", $totalCount);
                    $productCount += data.data.products.length;
                    // console.log("New Count" + $productCount);
                    for ($product of data.data.products) {
                        $dropdown = $product.sku.length;
                        $dropdwnlistname = "";
                        for ($i = 0; $i < $dropdown; $i++) {
                            if ($i === 0) {
                                $dropdwnlistname += "<div class = 'opt-nam' style='color:#38251d' data-sku-id='" + $product.sku[$i].id + "' data-discount='" + $product.sku[$i].discount + "' data-discount-price='" + $product.sku[$i].discounted_price + "' data-actual-price='" + $product.sku[$i].actual_price + "'>" + $product.sku[$i].title + "</div>";
                            } else {
                                $dropdwnlistname += "<div class = 'opt-nam' data-sku-id='" + $product.sku[$i].id + "' data-discount='" + $product.sku[$i].discount + "' data-discount-price='" + $product.sku[$i].discounted_price + "' data-actual-price='" + $product.sku[$i].actual_price + "'>" + $product.sku[$i].title + "</div>";
                            }
                        }

                        $discount = $product.sku[0].discount;
                        if ($discount == null) {
                            $discount_data = `<span class="product-discount-wrapper" style="display:none;">
                                                    <span class="prdct-discnt discount-percent">${$discount}</span>
                                                    <span class="prdct-discnt-of">Off</span>
                                                </span>`;
                            $main_price = `<span class="cart-main-price prodct-price" style="display:none;">
                                                <del>Rs.<span class="cart-product-actual-price actual-price">${$product.sku[0].actual_price}<span></del>
                                                </span>`;

                        } else {
                            $discount_data = `<span class="product-discount-wrapper">
                                                    <span class="prdct-discnt discount-percent">${$discount}</span>
                                                    <span class="prdct-discnt-of">Off</span>
                                                </span>`;
                            $main_price = `<span class="cart-main-price prodct-price">
                                                <del>Rs.<span class="cart-product-actual-price actual-price">${$product.sku[0].actual_price}<span></del>
                                                </span>`;
                        }
                        $('#product-list').append(`<div class="product-wrapper" id="${$product.id}">
                                        <div class="product-pic-round">
                                            <div class="product-img">
                                                <img src="./assets/images/products/${$product.image}" alt="apple" class="fruit-product" />
                                            </div>
                                        </div>
                                        <div class="product-details">
                                            <h2 class="product-name">${$product.name}</h2>
                                            <p class="product-quantity">${$product.sku[0].title}</p>
                                            <p class="product-price">
                                                Rs.<span class="product-discnt-price discount-price">${$product.sku[0].discounted_price}</span>
                                                ${$main_price}
                                                ${$discount_data}
                                            </p>
                                        </div>
                                        <div class="add-to-cart-details">
                                            <h2 class="cart-product-name">${$product.name}</h2>
                                            <div class="drop-down" id="${$product.id}">
                                                <div class="slctd-box">
                                                    <div class="slctd-opt">${$product.sku[0].title}</div>
                                                    <span class="drp-dwn-btn-wrpr">
                                                        <svg version="1.1" class="drp-dwn-btn-icn" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px"
                                                        y="0px" width="451.847px" height="451.847px" viewBox="0 0 451.847 451.847" fill="#f5764d"
                                                        style="enable-background:new 0 0 451.847 451.847;" xml:space="preserve">
                                                            <g>
                                                            <path d="M225.923,354.706c-8.098,0-16.195-3.092-22.369-9.263L9.27,151.157c-12.359-12.359-12.359-32.397,0-44.751
                                                            c12.354-12.354,32.388-12.354,44.748,0l171.905,171.915l171.906-171.909c12.359-12.354,32.391-12.354,44.744,0
                                                            c12.365,12.354,12.365,32.392,0,44.751L248.292,345.449C242.115,351.621,234.018,354.706,225.923,354.706z" />
                                                            </g>
                                                        </svg>
                                                    </span>
                                                </div>
                                                <div class="optns-wrpr">
                                                    ${$dropdwnlistname}
                                                </div>
                                            </div>
                                            <p class="cart-product-price">
                                                Rs.<span class="cart-product-discnt-price discount-price">${$product.sku[0].discounted_price}</span>
                                                ${$main_price}
                                                ${$discount_data}
                                            </p>
                                            <div class="main-quantity-items">
                                                <div class="quantity-item qnty-minus-btn" id="minus-${$product.id}"></div>
                                                <span class="no-of-items" id="qnty-count">1</span>
                                                <div class=" quantity-item qnty-plus-btn" id="plus-${$product.id}"></div>
                                            </div>
                                            <div class="add-to-cart-item">
                                                <button class="add-to-cart-btn">
                                                    Add to Cart
                                                    <span>
                                                        <svg class="cart-btn-arrow" id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                                                            <defs>
                                                                <style>
                                                                    .cls-1 {
                                                                        fill: #fff;
                                                                    }
                                                                </style>
                                                            </defs>
                                                            <title>White Arrow</title>
                                                            <path class="cls-1" d="M334.72,409a15.85,15.85,0,1,1-22.53-22.31L426.45,272.4H49.4a15.87,15.87,0,0,1-16-15.78,16.07,16.07,0,0,1,16-16h377l-114.26-114a16.18,16.18,0,0,1,0-22.53,15.79,15.79,0,0,1,22.53,0L476,245.35a15.9,15.9,0,0,1,0,22.31Z" />
                                                        </svg>
                                                    </span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>`)
                    }

                    $loading = false;
                } else {
                    // console.log(data.status);
                }
                // console.log(data);
                $pageNumber += 1;
            }
        });
    }

    $(document).ready(function() {

        $(window).scroll(function() {

            $topWindow = $(window).scrollTop();
            // console.log("TOP SCREEN" + $topWindow);
            $top_of_element = $("#product-list").offset().top;
            // console.log("TOP" + $top_of_element);
            $totalHeight = $("#product-list").outerHeight();
            // console.log("TOTAL HEIGHT" + $totalHeight);
            $innerWindow = $(window).innerHeight();
            // console.log("INNER HEIGHT" + $innerWindow);
            if (!$loading && ($productCount != $totalCount) && $topWindow >= ($top_of_element + $totalHeight - $innerWindow)) {
                // console.log("REACHED", $top_of_element + $totalHeight - $innerWindow);
                loadMoreProducts();
            }
        });
    });
</script>
<script>
    //TOGGLING NESTED ul
    $(document).ready(function() {
        // global variables
        $slectdbox = $(".drop-down").find(".slctd-box");
        $dropdownicn = $(".drop-down").find(".drp-dwn-btn-icn");
        $dropdownlist = $(".drop-down ").find(".optns-wrpr");

        $(document).on('click', '.drop-down', function() {
            $clk = $(this).attr("id");
            $($dropdownlist).not("#" + $clk + " .optns-wrpr").removeClass("show");
            $($slectdbox).not("#" + $clk + " .slctd-box").removeClass("slctd-botm-bordr-remv").addClass("slctd-botm-bordr-add");
            $($dropdownicn).not("#" + $clk + " .drp-dwn-btn-icn").removeClass("drp-dwn-icn-rotat");
            $("#" + $clk + " .drp-dwn-btn-icn").toggleClass("drp-dwn-icn-rotat");
            $("#" + $clk + " .slctd-box").toggleClass("slctd-botm-bordr-remv").removeClass("slctd-botm-bordr-add");
            $("#" + $clk + " .optns-wrpr").toggleClass("show");

            // list selection code start
            $(document).on('click', "#" + $clk + " .opt-nam", function() {
                $sltdOpt = $("#" + $clk + " > .optns-wrpr").children();
                for ($i = 0; $i < $sltdOpt.length; $i++) {
                    if ($(this).html() == $sltdOpt[$i].textContent) {
                        $sltdOpt[$i].style.color = "#38251d";
                    } else {
                        $sltdOpt[$i].style.color = "rgba(56, 37, 29, 0.6)";
                    }
                }

                $discount = $(this).attr("data-discount");
                $discount_price = $(this).attr("data-discount-price");
                $actual_price = $(this).attr("data-actual-price");
                $("#" + $clk + " .discount-price").html($discount_price);
                $("#" + $clk + " .actual-price").html($actual_price);
                if ($discount == "" || $discount == "null") {
                    $("#" + $clk + " .product-discount-wrapper").hide();
                    $("#" + $clk + " .prodct-price").hide();
                } else {
                    $("#" + $clk + " .product-discount-wrapper").show();
                    $("#" + $clk + " .prodct-price").show();
                    $("#" + $clk + " .discount-percent").html($discount);
                }
                $text = $(this).html();
                $("#" + $clk + " .slctd-opt").html($text);
                $("#" + $clk + " .product-quantity").html($text);
            });
            // list selection code end
        });

        // HIDE OPTIONS IF CLICKED ANYWHERE ELSE ON PAGE
        $(document).on("click", function(event) {
            $alldropdownlist = $(".drop-down");
            if ($alldropdownlist.has(event.target).length == 0) {
                $(".optns-wrpr").removeClass("show");
                $(".drp-dwn-btn-icn").removeClass("drp-dwn-icn-rotat");
                $(".drop-down .slctd-box").removeClass("slctd-botm-bordr-remv");
            }
        });

        //    quantity start
        $(document).on('click', '.main-quantity-items .qnty-plus-btn', function() {
            $current_val = 1;
            $plus = $(this).attr("id");
            $qnty_val = $("#" + $plus).prev().text();
            current_val = $("#" + $plus).prev().text(++$qnty_val);
        });

        $(document).on('click', '.main-quantity-items .qnty-minus-btn', function() {
            $minus = $(this).attr("id");
            $qnty_val = $("#" + $minus).next().text();
            if ($qnty_val > 1) {
                $qnty_val = $("#" + $minus).next().text(--$qnty_val);
            } else {
                $qnty_val = $("#" + $minus).next().text($qnty_val);
            }
        });
        // quantity end

        // product on hover add to cart hide and show -- start
        $(".product-wrapper").hover(function() {
            $hvr_product = $(this).attr("id");
            $("#" + $hvr_product + " .add-to-cart-details").slideToggle(500).css({"display":"flex"});
        });
        // product on hover add to cart hide and show -- end
    });
</script>
</html>
